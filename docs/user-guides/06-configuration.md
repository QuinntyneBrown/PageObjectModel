# Configuration Guide

This guide explains how to configure the Playwright POM Generator using configuration files, environment variables, and command-line options.

## Configuration Sources

The tool supports three configuration methods (in order of precedence):

1. **Command-line options** (highest priority)
2. **Environment variables**
3. **Configuration files** (lowest priority)

### Priority Example

```bash
# appsettings.json: TestFileSuffix = "spec"
# Environment: POMGEN_Generator__TestFileSuffix = "test"
# Command-line: --test-suffix "e2e"

# Result: Uses "e2e" (command-line wins)
```

## Configuration Files

### appsettings.json

The primary configuration file. Place it in:
- The CLI tool directory (`src/PlaywrightPomGenerator.Cli/`)
- Your project root directory
- Current working directory

**Example appsettings.json:**
```json
{
  "Generator": {
    "FileHeader": "/**\n * @fileoverview {FileName}\n * @generated Automatically generated by PlaywrightPomGenerator\n * @date {GeneratedDate}\n * @version {ToolVersion}\n */",
    "TestFileSuffix": "spec",
    "ToolVersion": "1.0.0",
    "OutputDirectoryName": "e2e",
    "GenerateJsDocComments": true,
    "DefaultTimeout": 30000,
    "BaseUrlPlaceholder": "http://localhost:4200"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "PlaywrightPomGenerator": "Information"
    }
  }
}
```

### Environment-Specific Configuration

Create environment-specific configuration files:

```json
// appsettings.Development.json
{
  "Generator": {
    "BaseUrlPlaceholder": "http://localhost:4200"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Debug"
    }
  }
}
```

```json
// appsettings.Production.json
{
  "Generator": {
    "BaseUrlPlaceholder": "https://app.example.com"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Warning"
    }
  }
}
```

**Usage:**
```bash
# Set environment
$env:DOTNET_ENVIRONMENT = "Development"  # Windows PowerShell
export DOTNET_ENVIRONMENT=Development    # Linux/macOS

# Run tool (loads appsettings.Development.json)
playwright-pom-gen app ./src/my-app
```

## Configuration Options Reference

### Generator Options

#### FileHeader
Custom header template for all generated files.

- **Type:** String
- **Default:** `""` (no header)
- **Supports placeholders:**
  - `{FileName}` - Name of the generated file
  - `{GeneratedDate}` - Date/time of generation
  - `{ToolVersion}` - Tool version from configuration

**Examples:**
```json
{
  "FileHeader": "// Auto-generated on {GeneratedDate}"
}
```

```json
{
  "FileHeader": "/**\n * File: {FileName}\n * Generated: {GeneratedDate}\n * Version: {ToolVersion}\n * DO NOT EDIT\n */"
}
```

```json
{
  "FileHeader": "// Copyright 2026 ACME Corp\n// Generated by PlaywrightPomGenerator v{ToolVersion}"
}
```

#### TestFileSuffix
Suffix for test files (before `.ts` extension).

- **Type:** String
- **Default:** `"spec"`
- **Examples:** `"spec"`, `"test"`, `"e2e"`

**Result:**
- `"spec"` → `home.spec.ts`
- `"test"` → `home.test.ts`
- `"e2e"` → `home.e2e.ts`

**Configuration:**
```json
{
  "TestFileSuffix": "test"
}
```

#### ToolVersion
Version string used in file headers.

- **Type:** String
- **Default:** `"1.0.0"`

**Configuration:**
```json
{
  "ToolVersion": "2.1.0"
}
```

#### OutputDirectoryName
Default name for the output directory.

- **Type:** String
- **Default:** `"e2e"`

**Configuration:**
```json
{
  "OutputDirectoryName": "playwright-tests"
}
```

**Note:** Can be overridden by `--output` command-line option.

#### GenerateJsDocComments
Whether to generate JSDoc comments for all functions and methods.

- **Type:** Boolean
- **Default:** `true`

**Configuration:**
```json
{
  "GenerateJsDocComments": false
}
```

**Effect:**
```typescript
// With GenerateJsDocComments: true
/**
 * Navigate to the home page
 */
async navigateToHome() {
  await this.page.goto('/home');
}

// With GenerateJsDocComments: false
async navigateToHome() {
  await this.page.goto('/home');
}
```

#### DefaultTimeout
Default timeout in milliseconds for Playwright operations.

- **Type:** Integer
- **Default:** `30000` (30 seconds)
- **Range:** 1000 to 300000 (1 second to 5 minutes)

**Configuration:**
```json
{
  "DefaultTimeout": 60000
}
```

**Effect:**
```typescript
// In generated playwright.config.ts
export default defineConfig({
  timeout: 60000,  // From configuration
  expect: {
    timeout: 5000
  },
  // ...
});
```

#### BaseUrlPlaceholder
Placeholder URL for generated Playwright configurations.

- **Type:** String
- **Default:** `"http://localhost:4200"`

**Configuration:**
```json
{
  "BaseUrlPlaceholder": "https://staging.example.com"
}
```

**Effect:**
```typescript
// In generated playwright.config.ts
export default defineConfig({
  use: {
    baseURL: 'https://staging.example.com',
  },
});
```

### Logging Options

#### LogLevel
Configure logging verbosity.

- **Type:** Object with log levels
- **Levels:** `Trace`, `Debug`, `Information`, `Warning`, `Error`, `Critical`, `None`

**Configuration:**
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "PlaywrightPomGenerator": "Debug",
      "PlaywrightPomGenerator.Core": "Trace",
      "Microsoft": "Warning",
      "System": "Warning"
    }
  }
}
```

**Log Level Meanings:**
- **Trace:** Very detailed logs, for debugging
- **Debug:** Debug information, detailed flow
- **Information:** General informational messages
- **Warning:** Warning messages, non-critical issues
- **Error:** Error messages, failures
- **Critical:** Critical failures
- **None:** No logging

## Environment Variables

Override any configuration value using environment variables with the `POMGEN_` prefix.

### Syntax

```
POMGEN_<Section>__<Key>=<Value>
```

**Note:** Use double underscores (`__`) to separate section from key.

### Examples

**Windows PowerShell:**
```powershell
# Set test file suffix
$env:POMGEN_Generator__TestFileSuffix = "test"

# Set output directory
$env:POMGEN_Generator__OutputDirectoryName = "playwright"

# Set base URL
$env:POMGEN_Generator__BaseUrlPlaceholder = "http://localhost:3000"

# Set log level
$env:POMGEN_Logging__LogLevel__Default = "Debug"

# Set timeout
$env:POMGEN_Generator__DefaultTimeout = "60000"

# Disable JSDoc comments
$env:POMGEN_Generator__GenerateJsDocComments = "false"

# Run tool
playwright-pom-gen app ./src/my-app
```

**Linux/macOS Bash:**
```bash
# Set test file suffix
export POMGEN_Generator__TestFileSuffix="test"

# Set output directory
export POMGEN_Generator__OutputDirectoryName="playwright"

# Set base URL
export POMGEN_Generator__BaseUrlPlaceholder="http://localhost:3000"

# Set log level
export POMGEN_Logging__LogLevel__Default="Debug"

# Run tool
playwright-pom-gen app ./src/my-app
```

**Inline (Linux/macOS):**
```bash
POMGEN_Generator__TestFileSuffix="test" \
POMGEN_Generator__DefaultTimeout="60000" \
playwright-pom-gen app ./src/my-app
```

### Common Environment Variable Examples

```bash
# Development environment
export POMGEN_Generator__BaseUrlPlaceholder="http://localhost:4200"
export POMGEN_Logging__LogLevel__Default="Debug"

# CI/CD environment
export POMGEN_Generator__FileHeader="// Auto-generated in CI"
export POMGEN_Generator__TestFileSuffix="test"
export POMGEN_Logging__LogLevel__Default="Warning"

# Production
export POMGEN_Generator__BaseUrlPlaceholder="https://app.example.com"
export POMGEN_Generator__GenerateJsDocComments="false"
```

## Command-Line Options

Command-line options override both configuration files and environment variables.

### Global Options

Available for all commands:

#### --header
Custom file header template.

```bash
playwright-pom-gen app . --header "// Copyright 2026"
```

```bash
playwright-pom-gen app . --header "/**\n * Generated: {GeneratedDate}\n * File: {FileName}\n */"
```

#### --test-suffix
Test file suffix.

```bash
playwright-pom-gen app . --test-suffix "test"
```

```bash
playwright-pom-gen app . --test-suffix "e2e"
```

### Command-Specific Options

See individual command guides:
- [Generate App Command](02-generate-app.md#options)
- [Generate Workspace Command](03-generate-workspace.md#options)
- [Generate Artifacts Command](04-generate-artifacts.md#options)
- [Generate SignalR Mock Command](05-generate-signalr-mock.md#options)

## Configuration Examples

### Example 1: Minimal Configuration

```json
{
  "Generator": {
    "TestFileSuffix": "test"
  }
}
```

All other options use defaults.

### Example 2: Corporate Standard

```json
{
  "Generator": {
    "FileHeader": "/**\n * Copyright 2026 ACME Corporation\n * Confidential and Proprietary\n *\n * File: {FileName}\n * Generated: {GeneratedDate}\n * Generator Version: {ToolVersion}\n *\n * WARNING: This file is auto-generated. Do not modify.\n * Any changes will be lost when regenerated.\n */",
    "TestFileSuffix": "spec",
    "ToolVersion": "1.0.0",
    "OutputDirectoryName": "e2e-tests",
    "GenerateJsDocComments": true,
    "DefaultTimeout": 45000,
    "BaseUrlPlaceholder": "http://localhost:4200"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    }
  }
}
```

### Example 3: Fast Iteration (Development)

```json
{
  "Generator": {
    "GenerateJsDocComments": false,
    "FileHeader": "",
    "BaseUrlPlaceholder": "http://localhost:4200"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Debug",
      "PlaywrightPomGenerator": "Trace"
    }
  }
}
```

### Example 4: CI/CD Pipeline

```json
{
  "Generator": {
    "FileHeader": "// Auto-generated in CI/CD pipeline\n// Build: {ToolVersion}\n// Date: {GeneratedDate}",
    "TestFileSuffix": "test",
    "OutputDirectoryName": "tests",
    "GenerateJsDocComments": false,
    "DefaultTimeout": 60000,
    "BaseUrlPlaceholder": "https://staging.example.com"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "PlaywrightPomGenerator": "Information"
    }
  }
}
```

### Example 5: Multiple Environments

**appsettings.json (base):**
```json
{
  "Generator": {
    "TestFileSuffix": "spec",
    "GenerateJsDocComments": true
  }
}
```

**appsettings.Development.json:**
```json
{
  "Generator": {
    "BaseUrlPlaceholder": "http://localhost:4200",
    "DefaultTimeout": 30000
  },
  "Logging": {
    "LogLevel": {
      "Default": "Debug"
    }
  }
}
```

**appsettings.Staging.json:**
```json
{
  "Generator": {
    "BaseUrlPlaceholder": "https://staging.example.com",
    "DefaultTimeout": 45000
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    }
  }
}
```

**appsettings.Production.json:**
```json
{
  "Generator": {
    "BaseUrlPlaceholder": "https://app.example.com",
    "DefaultTimeout": 60000
  },
  "Logging": {
    "LogLevel": {
      "Default": "Warning"
    }
  }
}
```

**Usage:**
```bash
# Development
DOTNET_ENVIRONMENT=Development playwright-pom-gen app .

# Staging
DOTNET_ENVIRONMENT=Staging playwright-pom-gen app .

# Production
DOTNET_ENVIRONMENT=Production playwright-pom-gen app .
```

## Configuration File Locations

The tool searches for configuration files in this order:

1. Current working directory
2. Project root (where you run the command)
3. CLI tool directory

**Search order:**
1. `./appsettings.{Environment}.json`
2. `./appsettings.json`
3. `<CLI-directory>/appsettings.{Environment}.json`
4. `<CLI-directory>/appsettings.json`

**Best practice:** Place `appsettings.json` in your project root.

## Validation

The tool validates configuration values:

### Invalid Values

```json
{
  "Generator": {
    "DefaultTimeout": -1000  // ❌ Must be positive
  }
}
```

**Error:**
```
Configuration error: DefaultTimeout must be between 1000 and 300000
```

### Invalid Types

```json
{
  "Generator": {
    "GenerateJsDocComments": "yes"  // ❌ Must be boolean
  }
}
```

**Error:**
```
Configuration error: GenerateJsDocComments must be a boolean value
```

## Configuration Best Practices

### 1. Version Control Configuration

**Commit:**
- `appsettings.json` (base configuration)
- `appsettings.Development.json`
- Environment-specific templates

**Don't commit:**
- `appsettings.Local.json` (personal overrides)
- Files with sensitive data

**.gitignore:**
```
appsettings.Local.json
appsettings.*.local.json
```

### 2. Use Environment Variables in CI/CD

```yaml
# GitHub Actions
- name: Generate tests
  env:
    POMGEN_Generator__BaseUrlPlaceholder: ${{ secrets.STAGING_URL }}
    POMGEN_Generator__DefaultTimeout: "60000"
  run: playwright-pom-gen workspace .
```

### 3. Layer Configurations

Base → Environment → Command-line

```json
// appsettings.json (base - commit this)
{
  "Generator": {
    "TestFileSuffix": "spec",
    "GenerateJsDocComments": true
  }
}

// appsettings.Development.json (environment - commit this)
{
  "Generator": {
    "BaseUrlPlaceholder": "http://localhost:4200"
  },
  "Logging": {
    "LogLevel": { "Default": "Debug" }
  }
}

// Command-line (runtime - don't commit)
playwright-pom-gen app . --test-suffix "test"
```

### 4. Document Custom Configurations

Add comments (JSON5) or create a README:

```markdown
# Configuration Guide

## Our Settings

- **TestFileSuffix:** "test" (company standard)
- **DefaultTimeout:** 45000 (45 seconds for slow CI)
- **FileHeader:** Includes copyright notice
- **BaseUrlPlaceholder:** Changes per environment

## Environments

- Development: `http://localhost:4200`
- Staging: `https://staging.example.com`
- Production: `https://app.example.com`
```

### 5. Validate Configuration

```bash
# Test configuration before committing
playwright-pom-gen app . --output ./temp-test

# Check generated files
cat ./temp-test/page-objects/home.page.ts | head -n 10

# Clean up
rm -rf ./temp-test
```

## Troubleshooting Configuration

### Problem: Configuration Not Loading

**Check:**
```bash
# Verify file exists
ls appsettings.json

# Verify JSON is valid
cat appsettings.json | jq '.'

# Check file permissions
ls -la appsettings.json
```

### Problem: Environment Variables Not Working

**Debug:**
```bash
# Verify variable is set (Linux/macOS)
printenv | grep POMGEN

# Verify variable is set (Windows)
$env:POMGEN_Generator__TestFileSuffix

# Test with explicit value
POMGEN_Generator__TestFileSuffix="test" playwright-pom-gen app . --help
```

### Problem: Wrong Values Being Used

**Check precedence:**
1. Command-line option (highest)
2. Environment variable
3. Configuration file (lowest)

```bash
# Disable all sources to test
mv appsettings.json appsettings.json.bak
unset POMGEN_Generator__TestFileSuffix
playwright-pom-gen app . --test-suffix "test"
# Now only command-line option is used
```

## Next Steps

- Learn about [Global Options](07-global-options.md) available on all commands
- Understand [Output Structure](08-output-structure.md) influenced by configuration
- Review [Best Practices](10-best-practices.md) for configuration management
- See [Troubleshooting](09-troubleshooting.md) for configuration issues
